"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@material-ui/lab/Autocomplete/Autocomplete"),t=require("react-admin"),r=require("@material-ui/core"),n=require("react"),a=require("@mui/material"),o=require("@mui/icons-material/ControlPoint"),l=require("@mui/icons-material/Edit");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=i(e),c=i(n),d=i(o),f=i(l);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b(){return(b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function g(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}(e,t)||h(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||h(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){if(e){if("string"==typeof e)return E(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var O=function(e){return e?Array.isArray(e)?e:[e]:[]},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=m({r:{min:96,max:255},g:{min:96,max:255},b:{min:96,max:255}},t),n=P(e),a=x(Math.floor(268435455*n)),o=a(),l=a(),i=a(),u=65536*Math.floor(o*(r.r.max-r.r.min)+r.r.min)+256*Math.floor(l*(r.g.max-r.g.min)+r.g.min)+Math.floor(i*(r.b.max-r.b.min)+r.b.min),c=u.toString(16).padStart(6,"0");return"#"+c},P=function(e){return Math.abs(Math.sin(e.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0)))},x=function(e){return function(){var t=0|(e+=2654435769);return t^=t>>>16,t=Math.imul(t,569420461),t^=t>>>15,t=Math.imul(t,1935289751),((t^=t>>>15)>>>0)/4294967296}},S=Object.freeze({__proto__:null,arrayFromLdField:O,colorFromString:C,numberFromString:P,mulberry32:x}),j=["relationshipPredicate","labelTagPredicate","colorTagPredicate","colorResourcePredicate","avatarTagPredicate","avatarResourcePredicate","labelResourcePredicate","showColors","tagResource","entityResource","resourceDefaultIcon","tagDefaultIcon","resourceName","tagName","excludeIds","onSelectionChange","renderTagOption","renderResourceOption"],w=function(e){var a=e.relationshipPredicate,o=e.labelTagPredicate,l=e.colorTagPredicate,i=e.colorResourcePredicate,d=e.avatarTagPredicate,f=e.avatarResourcePredicate,s=e.labelResourcePredicate,m=e.showColors,p=e.tagResource,h=e.entityResource,E=e.resourceDefaultIcon,P=e.tagDefaultIcon,x=e.resourceName,S=e.tagName,w=e.excludeIds,k=e.onSelectionChange,T=e.renderTagOption,I=e.renderResourceOption,A=g(e,j),R=t.useTranslate(),L=v(n.useState(e.value||[]),2),D=L[0],M=L[1];n.useEffect((function(){M(e.value||[])}),[e.value]);var F=t.useGetList(p),q=F.data,W=F.isLoading,_=t.useGetList(h),z=_.data,B=_.isLoading,G=[].concat(y(Object.values(q).sort((function(e,t){return(e[o]||"").localeCompare(t[o])})).map((function(e){return e.id}))),y(Object.values(z).sort((function(e,t){return(e[s]||"").localeCompare(t[s])})).map((function(e){return e.id})))).filter((function(e){return!w.includes(e)})),N=function(e){var t=O(e[a]);return 0!==t.length&&t.every((function(e){return D.includes(e)}))},U=T||function(e,t){var n=e[l]||m&&C(e[o]);return c.default.createElement(c.default.Fragment,null,c.default.createElement(r.Checkbox,{checked:t}),(e[d]||P)&&c.default.createElement(r.ListItemAvatar,{style:{marginLeft:"9px",marginRight:"9px",minWidth:"40px"}},c.default.createElement(r.Avatar,{src:e[d],style:{backgroundColor:n,border:"1px solid #bdbdbd"}},P)),c.default.createElement(r.Chip,{size:"small",variant:"outlined",style:{backgroundColor:n,marginLeft:"9px"},label:e[o]}))},$=I||function(e,t){return c.default.createElement(c.default.Fragment,null,c.default.createElement(r.Checkbox,{checked:t}),(e[f]||E)&&c.default.createElement(r.ListItemAvatar,{style:{marginLeft:"9px",marginRight:"9px",minWidth:"40px"}},c.default.createElement(r.Avatar,{src:e[f],style:{backgroundColor:e[i],border:"1px solid #bdbdbd"}},E)),c.default.createElement(r.Typography,{variant:"body2",color:"textPrimary",style:{marginLeft:"9px"}},e[s]))};return c.default.createElement(u.default,b({multiple:!0,options:G,value:D,groupBy:function(e){return q[e]?S||p:x||h},getOptionLabel:function(e){var t,r;return(null===(t=z[e])||void 0===t?void 0:t[s])||(null===(r=q[e])||void 0===r?void 0:r[o])||""},onChange:function(e,t,r,n){var o=n.option,l=[],i=[];if(q[o]){var u=q[o],c=O(u[a]);N(u)?i.push.apply(i,y(c)):l.push.apply(l,y(c))}else z[o]&&("select-option"===r?l.push(o):"remove-option"===r&&i.push(o));var d=y(new Set([].concat(y(D),l).filter((function(e){return!i.includes(e)}))));M(d),k({ids:d})},renderInput:function(e){return c.default.createElement(r.TextField,b({},e,{variant:"outlined",label:R("auth.input.agent_select"),fullWidth:!0}))},renderOption:function(e){return q[e]?U(q[e],N(q[e])):z[e]?$(z[e],D.includes(e)):void 0},loading:W||B,fullWidth:!0,disableCloseOnSelect:!0,closeIcon:null},A))};w.defaultProps={showColors:!0,excludeIds:[]};var k=["lightblue","lightgreen","lightpink","lightyellow","lightgrey"],T=function(e){var r=e.relationshipPredicate,o=e.namePredicate,l=e.colorPredicate,i=e.avatarPredicate,u=e.idPredicate,s=e.tagResource,b=e.showColors,g=e.allowCreate,h=v(n.useState(!1),2),E=h[0],P=h[1],x=v(n.useState(""),2),S=x[0],j=x[1],w=v(n.useState(k[0]),2),T=w[0],A=w[1],R=v(n.useState(!1),2),L=R[0],D=R[1],M=v(n.useState(null),2),F=M[0],q=M[1],W=t.useTranslate(),_=t.useRecordContext(),z=null==_?void 0:_.id,B=v(t.useUpdate(),1)[0],G=v(t.useCreate(),1)[0],N=v(n.useState(!1),2),U=N[0],$=N[1],H=v(n.useState(!1),2),J=H[0],K=H[1],Q=t.useGetList(s),V=Q.data,X=Q.ids,Y=Q.loading,Z=Q.refetch,ee=v(n.useState({}),2),te=ee[0],re=ee[1],ne=v(n.useState([]),2),ae=ne[0],oe=ne[1];n.useEffect((function(){X.length>0&&(re(V),oe(Object.values(V).filter((function(e){var t;return null===(t=e[r])||void 0===t?void 0:t.includes(z)})).map((function(e){return e[u]}))))}),[te,V,X,z,u,r]);var le=n.useCallback((function(){!J&&U&&(K(!0),Promise.all(Object.values(te).map((function(e){var t,n=O(e[r]),a=n.includes(z),o=ae.includes(e[u]);return a===o?Promise.resolve():(t=o?[].concat(y(n),[z]):n.filter((function(e){return e!==z})),B(s,e[u],m(m({},e),{},p({},r,t))))}))).then((function(){$(!1),K(!1)})))}),[J,z,ae,te,U,r,u,s,B]);n.useEffect((function(){return function(){return le()}}),[le]),n.useEffect((function(){Y||!U||J||new Promise((function(e){return setTimeout(e,15e3)})).then((function(){le()}))}),[Y,U,J,le]);var ie=Object.values(te).map((function(e){return{id:e[u],name:e[o],color:e[l]||b&&C(e[o]),avatar:e[i],owners:O(e[r])}})),ue=ie.filter((function(e){return ae.includes(e.id)})),ce=ie.filter((function(e){return!ae.includes(e.id)})),de=function(e){oe([].concat(y(ae),[e])),$(!0),q(null)},fe=function(){P(!0),q(null),D(!1)};return c.default.createElement(c.default.Fragment,null,c.default.createElement(a.Grid,{container:!0,spacing:1},Y&&c.default.createElement(t.LoadingIndicator,null),ue.map((function(e){return c.default.createElement(a.Grid,{item:!0,mt:1,mb:1,key:e.id},c.default.createElement(a.Chip,{size:"small",variant:"outlined",onDelete:function(){return t=e.id,oe(ae.filter((function(e){return e!==t}))),void $(!0);var t},label:e.name,style:{backgroundColor:e.color,border:0}}))})),c.default.createElement(a.Grid,{item:!0,mt:1,mb:1},c.default.createElement(a.Chip,{icon:c.default.createElement(d.default,null),size:"small",variant:"outlined",onClick:function(e){q(e.currentTarget)},label:W("ra.action.add"),color:"secondary"}))),c.default.createElement(a.Menu,{open:Boolean(F),onClose:function(){q(null)},anchorEl:F},null==ce?void 0:ce.map((function(e){return c.default.createElement(a.MenuItem,{key:e.id,onClick:function(){return de(e.id)}},c.default.createElement(a.Chip,{size:"small",variant:"outlined",label:e.name,style:{backgroundColor:e.color,border:0},onClick:function(){return de(e.id)}}))})),g&&c.default.createElement(a.MenuItem,{onClick:fe},c.default.createElement(a.Chip,{icon:c.default.createElement(f.default,null),size:"small",variant:"outlined",onClick:fe,color:"primary",label:W("ra.action.create")}))),g&&c.default.createElement(a.Dialog,{open:E,onClose:function(){return P(!1)},"aria-labelledby":"form-dialog-title"},c.default.createElement("form",{onSubmit:function(e){var t;e.preventDefault(),D(!0),G(s,m((p(t={},o,S),p(t,r,[z]),t),l&&p({},l,T)||{}),{onSuccess:function(){q(null),P(!1),Z()}})}},c.default.createElement(a.DialogTitle,{id:"form-dialog-title"},"Create a new tag"),c.default.createElement(a.DialogContent,null,c.default.createElement(a.TextField,{autoFocus:!0,label:"Tag name",fullWidth:!0,value:S,onChange:function(e){return j(e.target.value)},sx:{mt:1}}),l&&c.default.createElement(a.Box,{display:"flex",flexWrap:"wrap",width:230,mt:2},k.map((function(e){return c.default.createElement(I,{key:e,color:e,selected:e===T,handleClick:function(){A(e)}})})))),c.default.createElement(a.DialogActions,null,c.default.createElement(a.Button,{onClick:function(){return P(!1)},color:"primary"},W("ra.action.cancel")),c.default.createElement(a.Button,{type:"submit",color:"primary",disabled:L},W("ra.action.create"))))))},I=function(e){return c.default.createElement(a.Box,{component:"button",type:"button",sx:{bgcolor:e.color,width:30,height:30,borderRadius:15,border:e.selected?"2px solid grey":"none",display:"inline-block",margin:1},onClick:e.handleClick})};T.defaultProps={idPredicate:"id",showColors:!0,avatarPredicate:void 0,colorPredicate:void 0,allowCreate:!0},exports.ResourceSelectWithTags=w,exports.TagsListEdit=T,exports.utils=S;
//# sourceMappingURL=index.cjs.js.map
